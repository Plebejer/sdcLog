<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<style>
/* CSS for Markstat 2.0 using Pandoc 2.0 */
body{padding:14px 28px;}
body, table {font-family: Helvetica, Arial, Sans-serif; font-size: 14px;}
h1, h2, h3, h4 {font-weight: normal; color: #3366cc}
h1 {font-size: 200%;}
h2 {font-size: 150%;}
h3 {font-size: 120%;}
h4 {font-size: 100%; font-weight:bold}
img.center {display:block; margin-left:auto; margin-right:auto}
.small{font-size:8pt;}
a {color: black;}
a:visited {color: #808080;}
a.plain {text-decoration:none;}
a.plain:hover {text-decoration:underline;}
.em {font-weight:bold;}
pre, code {font-family: "lucida console", monospace;}
pre.stata {font-size:13px; line-height:13px;}
pre {padding:8px; border:1px solid #c0c0c0; border-radius:8px; background-color:#fdfdfd;}
code {color:#3366cc; background-color:#fafafa;}
pre code { color:black; background-color:white}
/* Added for Pandoc */
figure > img, div.figure > img {display:block; margin:auto}
figcaption, p.caption {text-align:center; font-weight:bold; color:#3366cc;}
h1.title {text-align:center; margin-bottom:0}
p.author, h2.author {font-style:italic; text-align:center;margin-top:4px;margin-bottom:0}
p.date, h3.date {text-align:center;margin-top:4px; margin-bottom:0}
/* Tables*/
table { margin:auto; border-collapse:collapse; }
table caption { margin-bottom:1ex;}
th, td { padding:4px 6px;}
thead tr:first-child th {border-top:1px solid black; padding-top:6px}
thead tr:last-child  th {padding-bottom:6px}
tbody tr:first-child td {border-top:1px solid black; padding-top:6px}
tbody tr:last-child  td {padding-bottom:6px;}
table tbody:last-child tr:last-child td {border-bottom:1px solid black;}
</style>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Harald Stahl" />
  <meta name="date" content="2019-11-25" />
  <title>Data disclosure control for descriptives - Examples</title>
  <style type="text/css">code{white-space: pre;}</style>
</head>
<body>
<div id="header">
<h1 class="title">Data disclosure control for descriptives - Examples</h1>
<h2 class="author">Harald Stahl</h2>
<h3 class="date">2019-11-25</h3>
</div>
<h1 id="create-artificial-data">Create artificial data</h1>
<p>Create artificial data for eleven ids (1-11), ten years (2001-2010), three countries (17, 39, 400), and a continuous variable x.</p>
<pre class='stata'>. clear

. qui set obs 301

. gen id   = int((_n-1)/30)+1

. gen hv   = _n-30*(id-1)

. gen year = 2000+mod(hv,10)+10*(mod(hv,10)==0)    

. gen land = int((2000-year+hv)/10)+1 

. qui replace land =  17 if land==1

. qui replace land =  39 if land==2

. qui replace land = 400 if land==3    

. drop hv

. set seed 4869382

. gen x = runiform()
</pre>
<p>Create an id that has to be ignored since x is missing.</p>
<pre class='stata'>. qui replace id = 11 if _n==301  

. qui replace x  =  . if id==11
</pre>
<p>Set x to missing in the year 2002 for all ids but two so that there are too few distinct ids in this year.</p>
<pre class='stata'>. qui replace x = . if year==2002 &amp; id > 2
</pre>
<p>Create data for the dominance check</p>
<pre class='stata'>. qui gen byte xfordom = 5 if id==1

. qui replace  xfordom = 4 if id==2

. qui replace  xfordom =-4 if id==2 &amp; land==400

. qui replace  xfordom = 1 if id==3

. qui replace  xfordom =10 if id==3 &amp; land== 39 &amp; year>=2009

. cls
</pre>
<h1 id="applying-nobsdes">Applying nobsdes</h1>
<h2 id="n-o-b-s-d-e-s-without-o-p-t-i-o-n-s">N O B S D E S without O P T I O N S</h2>
<p>You will be asked for or be interested in the number of distinct ids unrelated to any other variable only rarely. Normally, confidentiality has to be resolved with respect to a continuous or discrete variable. In the artificial data, there are eleven distinct ids. Since x is set to missing for id==11, there are 11 distinct ids but only 10 distinct ids for nonmissing values of the variable x.</p>
<pre class='stata'>. nobsdes id 
Is id an identifier? 

Number of distinct values for identifier  id :   11

. nobsdes id x  

No problem with dominance. 
Number of distinct ids (id) of variable  x :   10
</pre>
<h2 id="how-to-use-the-b-y---o-p-t-i-o-n">How to use the B Y - O P T I O N</h2>
<p>In 2002 variable x is non missing for just two ids, id==1 and id==2.</p>
<pre class='stata'>. nobsdes id x, by(year)

<a style="color:#FF0000">D I S C L O S U R E problem:</a>
Share of largest two ids > 85%. 
Number of distinct ids (id) of variable x for each year :

──────────┬───────────────────────
     year │  sum(nobs)   mean(CR2)
──────────┼───────────────────────
     2001 │         10          25
     2002 │          2         100
     2003 │         10          31
     2004 │         10          29
     2005 │         10          31
     2006 │         10          25
     2007 │         10          31
     2008 │         10          31
     2009 │         10          30
     2010 │         10          27
──────────┴───────────────────────
</pre>
<p>Now you know year 2002 is problematic. At first sight, discarding this year seems to be a simple solution to get the output.</p>
<pre class='stata'>. table year if year!=2002, c(sum x)

──────────┬───────────
     year │     sum(x)
──────────┼───────────
     2001 │   14.71751
     2003 │   14.21137
     2004 │   13.52464
     2005 │    12.1655
     2006 │   16.41351
     2007 │   13.74528
     2008 │   14.25568
     2009 │   14.28874
     2010 │   13.06753
──────────┴───────────
</pre>
<p>However, if you drop just one row, the hidden row may be inferred by the visible rows and the total. Thus, you have to hide at least two rows, or, better, you aggregate.</p>
<pre class='stata'>. qui gen int bisyear = 2002 if (year==2001|year==2002)

. qui replace bisyear = 2004 if (year==2003|year==2004)

. qui replace bisyear = 2006 if (year==2005|year==2006)

. qui replace bisyear = 2008 if (year==2007|year==2008)

. qui replace bisyear = 2010 if (year==2009|year==2010)
</pre>
<pre class='stata'>. table bisyear, c(sum x)

──────────┬───────────
  bisyear │     sum(x)
──────────┼───────────
     2002 │   17.83253
     2004 │   27.73601
     2006 │   28.57901
     2008 │   28.00096
     2010 │   27.35627
──────────┴───────────
</pre>
<p>The <em>by</em>-option is mostly used with categorial data but it may also be used with &quot;sparse&quot; continuous data, for example external tax data. There may be a few tax rates that apply to only one or two firms so that there is a confidentiality problem. You can check using <em>nobsdes id, by(taxrate)</em>.</p>
<p>If you are quite sure, that there will be a problem, you may use the <em>gen</em> option and create two auxilliary variables for the number of distinct ids and the concentration ratio and restrict the output to the admissible cases.</p>
<pre class='stata'>. nobsdes id x, by(year) notab gen replace

<a style="color:#FF0000">D I S C L O S U R E problem:</a>
Share of largest two ids > 85%. 
Smallest number of distinct ids (id) of variable x for year: too small

. egen hvnobs = sum(tg_id_x), by(year)

. egen hvcr2  = mean(cr2_id_x), by(year)
</pre>
<pre class='stata'>. table year if hvnobs>2 &amp; hvcr2&lt;=85, c(sum x sum tg_id_x mean cr2_id_x)

──────────┬───────────────────────────────────────────────
     year │         sum(x)    sum(tg_id_x)  mean(cr2_id_x)
──────────┼───────────────────────────────────────────────
     2001 │       14.71751              10            25.0
     2003 │       14.21137              10            31.2
     2004 │       13.52464              10            28.6
     2005 │        12.1655              10            31.5
     2006 │       16.41351              10            25.2
     2007 │       13.74528              10            30.8
     2008 │       14.25568              10            30.8
     2009 │       14.28874              10            29.8
     2010 │       13.06753              10            27.4
──────────┴───────────────────────────────────────────────
</pre>
<p>Please, do not show the concentration ratio CR2 because this refers to only two observations and has to be disclosed.</p>
<pre class='stata'>. table year if hvnobs>2 &amp; hvcr2&lt;=85, c(sum x sum tg_id_x)

──────────┬───────────────────────────
     year │       sum(x)  sum(tg_id_x)
──────────┼───────────────────────────
     2001 │     14.71751            10
     2003 │     14.21137            10
     2004 │     13.52464            10
     2005 │      12.1655            10
     2006 │     16.41351            10
     2007 │     13.74528            10
     2008 │     14.25568            10
     2009 │     14.28874            10
     2010 │     13.06753            10
──────────┴───────────────────────────
</pre>
<p>This may also help you if you want to table the most important countries, industries etc.</p>
<h2 id="d-o-m-i-n-a-n-c-e">D O M I N A N C E</h2>
<p>There are 3 different ids with values for xfordom in each year.</p>
<pre class='stata'>. table id land if xfordom!=., c(sum xfordom) row

──────────┬─────────────────
          │       land      
       id │   17    39   400
──────────┼─────────────────
        1 │   50    50    50
        2 │   40    40   -40
        3 │   10    28    10
          │ 
    Total │  100   118    20
──────────┴─────────────────
</pre>
<p>Assume id==2 knows that there are two others and id==1 being much bigger than id==3. If you publish the sum, id==2 can guess the value of xfordom for id==1.<br />
For country== 17 it is near 100-40 = 60<br />
For country==400 it is near 20-(-40) = 60<br />
For country== 39 it is not the case that id==1 is much bigger than id==3.</p>
<pre class='stata'>. nobsdes id xfordom, by(land)

<a style="color:#FF0000">D I S C L O S U R E problem:</a>
Share of largest two ids > 85%. 
Number of distinct ids (id) of variable xfordom for each land :

──────────┬───────────────────────
     land │  sum(nobs)   mean(CR2)
──────────┼───────────────────────
       17 │          3          90
       39 │          3          76
      400 │          3          90
──────────┴───────────────────────
</pre>
<p>The data is now sorted</p>
<pre class='stata'>. des

Contains data
  obs:           301                          
 vars:            10                          
 size:         9,632                          
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
              storage   display    value
variable name   type    format     label      variable label
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
id              float   %9.0g                 
year            float   %9.0g                 
land            float   %9.0g                 
x               float   %9.0g                 
xfordom         byte    %8.0g                 
bisyear         int     %8.0g                 
tg_id_x         byte    %8.0g                 
cr2_id_x        float   %5.1f                 
hvnobs          float   %9.0g                 
hvcr2           float   %9.0g                 
────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
Sorted by: year
     Note: Dataset has changed since last saved.
</pre>
<h2 id="m-a-x-i-m-u-m-and-m-i-n-i-m-u-m">M A X I M U M and M I N I M U M</h2>
<p>MAXIMUM and MINIMUM are single observations. Therefore, they must not be shown. If necessary, the RDSC allows to publish approximate values calculated as averages of a sufficient number of observations (top coding). For maximum and minimum: at least five distinct entities have to be covered and the share of the two largest ones must not exceed 85 percentages of the total (dominance criterion).</p>
<p>Please use the ado-file <em>maxrdsc</em> to cope with this problem. If a table or cross-tabulation is desired use nobsdes after some preparatory steps.</p>
<pre class='stata'>. maxrdsc id x, min(12) max(12)     

No problems for maximum of x. Average maximum based on  5  distinct ids:  .9851794600486755
No problems for minimum of x. Average minimum based on  5  distinct ids:  .0121175773009392
</pre>
<h2 id="p-e-r-c-e-n-t-i-l-e-s">P E R C E N T I L E S</h2>
<p>Quantiles and percentiles are single observations, sometimes a weighted average of two adjacent observations. In principle, they must not be shown. However, occasionally they are needed to characterise a non-normal distribution or as more robust statistics.</p>
<p>If you display percentiles, the number of distinct ids between the minimum and the first percentile, between the first and the second percentile, ..., between the highest percentile and the maximum all have to be larger than two.</p>
<p>Percentiles have to be specified in ascending order.</p>
<pre class='stata'>. nobsdes id x if year==2010, pctile(5 50 90)

<a style="color:#FF0000">D I S C L O S U R E problem:</a>
Share of largest two ids > 85%. 
Number of distinct ids (id) for each percentile (min&lt;=p5&lt;=p50&lt;=p90&lt;=max) of variable x :

──────────┬───────────────────────
   pctile │  sum(nobs)   mean(CR2)
──────────┼───────────────────────
  .031719 │          2         100
 .3996747 │          8          47
 .8105488 │          8          33
      max │          3          68
──────────┴───────────────────────

. nobsdes id x, pctile(5 50 90) by(year) notab

<a style="color:#FF0000">D I S C L O S U R E problem:</a>
Share of largest two ids > 85%. 
Number of distinct ids (id) for the smallest percentile (min&lt;=p5&lt;=p50&lt;=p90&lt;=max) of variable x for year :  too small

. nobsdes id x, pctile(5 50 90) by(year) 

<a style="color:#FF0000">D I S C L O S U R E problem:</a>
Share of largest two ids > 85%. 
Number of distinct ids (id) for the smallest percentile (min&lt;=p5&lt;=p50&lt;=p90&lt;=max) of variable x for year : 

  ┌───────────────┐
  │ year   pctile │
  ├───────────────┤
  │ 2001       p5 │
  │ 2002      p50 │
  │ 2002      p90 │
  │ 2002      max │
  │ 2003       p5 │
  │ 2004       p5 │
  │ 2005       p5 │
  │ 2006       p5 │
  │ 2007       p5 │
  │ 2007      max │
  │ 2008       p5 │
  │ 2008      max │
  │ 2009       p5 │
  │ 2010       p5 │
  └───────────────┘
</pre>
<h2 id="creating-g-r-a-p-h-s">Creating G R A P H S</h2>
<p>If you want to make a graph you have to document that the graph is based on sufficient observations and that no two ids dominate. You have to use <em>nobsdes</em> before you create the graph. We recommend to save the graph as .png-file.</p>
<pre class='stata'>. nobsdes id x, by(year land) notab

<a style="color:#FF0000">D I S C L O S U R E problem:</a>
Share of largest two ids > 85%. 
Smallest number of distinct ids (id) of variable x for year land: too small

. nobsdes id x, by(year land) 

<a style="color:#FF0000">D I S C L O S U R E problem:</a>
Share of largest two ids > 85%. 
Number of distinct ids (id) of variable x for each year land :

──────────┬─────────────────
          │       land      
     year │   17    39   400
──────────┼─────────────────
     2001 │   10    10    10
          │   56    37    26
          │ 
     2002 │    2     2     2
          │  100   100   100
          │ 
     2003 │   10    10    10
          │   38    35    30
          │ 
     2004 │   10    10    10
          │   39    41    37
          │ 
     2005 │   10    10    10
          │   41    46    43
          │ 
     2006 │   10    10    10
          │   38    32    29
          │ 
     2007 │   10    10    10
          │   35    36    47
          │ 
     2008 │   10    10    10
          │   42    34    32
          │ 
     2009 │   10    10    10
          │   38    35    38
          │ 
     2010 │   10    10    10
          │   30    42    36
──────────┴─────────────────

. qui egen meanx = mean(x) if year!=2002, by(year land)

. egen tgland = tag(year land)

. gsort -tgland year land

. scatter meanx year if land==17 &amp; tgland

. graph export scatter.png, replace
(file scatter.png written in PNG format)
</pre>
<div class="figure">
<img src="scatter.png" alt="Example Graph" />
<p class="caption">Example Graph</p>
</div>
<h2 id="creating-h-i-s-t-o-g-r-a-m-s">Creating H I S T O G R A M S</h2>
<p>If you want to make a histogram you have to document that the graph is based on sufficient observations and that no two ids dominate. You have to use <em>nobsdes</em> before you create the graph. We recommend to save the graph as .png-file</p>
<pre class='stata'>. nobsdes id x, histogram(16)                 /* e.g. 16 bins */

No problem with dominance. 
Number of distinct ids (id) for the smallest of 16 bins of variable x : 5
</pre>
<p>This differs from the heigth of the bins</p>
<pre class='stata'>. qui histogram x, freq bin(16) addlabels

. graph export histogram.png, replace
(file histogram.png written in PNG format)
</pre>
<div class="figure">
<img src="histogram.png" alt="Example Histogram" />
<p class="caption">Example Histogram</p>
</div>
<h2 id="aggregating-d-a-t-a">Aggregating D A T A</h2>
<p>If you want to aggregate data for further use you have to document that the aggregate consists of enough observations and that no two ids dominate. You have to use <em>nobsdes</em> before you collapse the data.</p>
<pre class='stata'>. drop tg_id_x cr2_id_x

. nobsdes id x, by(year land) notab

<a style="color:#FF0000">D I S C L O S U R E problem:</a>
Share of largest two ids > 85%. 
Smallest number of distinct ids (id) of variable x for year land: too small

. drop if year==2002
(30 observations deleted)

. nobsdes id x, by(year land) notab

No problem with dominance. 
Smallest number of distinct ids (id) of variable x for year land: 10
</pre>
<pre class='stata'>. collapse (sum) x, by(year land)
</pre>
<pre class='stata'>. table year land, c(mean x) format(%5.1f)

──────────┬─────────────────
          │       land      
     year │   17    39   400
──────────┼─────────────────
     2001 │  3.1   5.1   6.5
     2003 │  4.5   4.2   5.5
     2004 │  5.0   4.1   4.5
     2005 │  4.2   4.2   3.8
     2006 │  4.7   5.9   5.8
     2007 │  4.9   5.1   3.7
     2008 │  3.3   5.6   5.3
     2009 │  4.4   5.6   4.2
     2010 │  5.0   4.4   3.7
──────────┴─────────────────

. scatter x year if land==17
</pre>
<p>If you want to document after the collapse command you have to create a new variable using the <em>gen</em> or <em>name</em> option.</p>
<pre class='stata'><em>nobsdes id x, by(year) notab</em> 
<em>gen collapse (sum) x tg_id_x, by(year land)</em>  
<em>table year, c(sum tg_id_x)</em>  
</pre>
</body>
</html>
